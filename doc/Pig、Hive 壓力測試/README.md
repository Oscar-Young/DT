# 計算六都兒童口罩各數

* 資料集下載

```
wget 'https://data.nhi.gov.tw/resource/mask/maskdata.csv'
```

## Pig

```pig
data = LOAD '/user/user01/01-04-2020-18-14.csv' USING PigStorage(',') AS (code:chararray,name:chararray,address:chararray,phone:chararray,adult:int,kid:int,time:chararray);
f = FILTER data BY $2 MATCHES '(臺北市|新北市|桃園市|臺中市|臺南市|高雄市).*';
g = FOREACH f GENERATE SUBSTRING($2,0,3),$5;
h = GROUP g BY $0;
i = FOREACH h GENERATE $0,SUM(g.kid);
DUMP i;
```
-------------------------------------

* 一人連線所花費時間

|  | 1 | 2 | 3 | 4 | 5 | 平均 |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| Tez | 55.389s | 55.272s | 57.463s | 56.322s | 55.189s | 55.927s |

* 十人連線所花費時間

|  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 平均 |
| ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- |
| Tez | 150.674s | 156.319s | 157.022s | 160.242s | 202.726s | 206.308s | 206.311s | 207.956s | 251.695s | 251.519s | 195.0772s |

-------------------------------------

## Hive

```sql
SELECT col1,col2 FROM 
(SELECT SUBSTR(address,1,3) AS col1 ,SUM(kid) AS col2 FROM mask01 GROUP BY SUBSTR(address,1,3))
 AS step1 WHERE col1 LIKE '臺北市%' OR col1 LIKE'新北市%' OR col1 LIKE'桃園市%' OR col1 LIKE'臺中市%' OR col1 LIKE'臺南市%' OR col1 LIKE'高雄市%';
```
-------------------------------------

* 一人連線所花費時間

|  | 1 | 2 | 3 | 4 | 5 | 平均 |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| Tez | 86.958s | 88.561s | 87.563s | 86.988s | 87.114s | 87.4368s |

* 十人連線所花費時間

|  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 平均 |
| ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- |
| Tez | 336.376s | 338.423s | 340.071s | 341.314s | 341.660s | 341.900s | 342.602s | 341.744s | 363.369s | 365.823s | 345.3282s |
